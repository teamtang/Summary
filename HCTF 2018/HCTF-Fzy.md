# HCTF
> 这是我完整参加的第一次CTF比赛，也是第一次怼一道题结结实实怼了两天。虽然确实学到了很多东西，离flag也越来越近，但最后还是没有做出来。非常有感触的是这个逐渐缩小范围的过程，从一开始毫无思路，到找到突破口，再查找资料，最后思路一点点清晰，离答案越来越近。赛后看了几份writeup，发现自己的思路虽然正确但属于比较tricky的，常规思路还是很考验基本功的。
## 题目：the_end
> 下面贴一下几个当时不明白的点和几种解题思路
### 知识点
> 在标准I/O库中，每个程序启动时有三个文件流是自动打开的，系统自动填充在bss段的，那就是 stdin，stderr，stdout_IO_FILE结构体的指针。  
> 
> setbuf作用：强制把缓冲区fflush出来，否则因为远程交互的问题不一定能看到printf的输出。
### 解题思路
#### 伪造vtable
> 主要关注exit函数，调用exit函数的时候会先清空流，这些流会以链的形式存放每个流会维持一个上面的结构体。在清空流的时候会调用vtable里面的虚函数。可以伪造vtable，用可写的5字节修改指针，指向伪造的vtable。
#### 修改libc的bss段上指针
> 分析exit汇编代码，找到可写的跳转目的地址，写入one_gadget。我之前也是顺着这个思路，但找地址时是在gdb中单步执行的，没有看出那个地址可写，一直在考虑一处call rax要怎么利用。结果那个地方涉及tls保护机制，利用十分困难，本题也不具备这样的条件，走进了死胡同。

## 反思
下次思路要再开阔些，多尝试新思路，不要一条道走到黑。另外心态上也要更平和，不要老想着时间快到了就做不下去题。还有如果觉得某道题目实在做不下去，应该适当放下，去尝试其他题目或去了解相关的基础知识，收获可能会更大。
